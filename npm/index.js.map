{"version":3,"sources":["../src/constants.ts","../src/utils.ts","../src/index.ts"],"names":["nodepath"],"mappings":"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","file":"index.js","sourcesContent":["import nodepath from \"node:path\";\n\nexport const DEFAULT_IGNORE_PATTERN = [\"node_modules/**\"];\nexport const PLUGIN_NAME = \"vite-plugin-conventional-router\";\nexport const PLUGIN_VIRTUAL_MODULE_NAME = \"virtual:routes\";\nexport const PLUGIN_MAIN_PAGE_FILE = \"index.tsx\";\n\nexport const LAYOUT_FILE_NAME = \"layout\";\nexport const NOT_FOUND_FILE_NAME = \"404\";\nexport const ERROR_BOUNDARY_FILE_NAME = \"errorBoundary\";\nexport const LOADER_FILE_NAME = \"loader\";\nexport const HANDLE_FILE_NAME = \"handle\";\n\nexport const OPTIONAL_ROUTE_FLAG = \"$\";\nexport const DYNAMIC_ROUTE_FLAG = \"@\";\nexport const SPLAT_ROUTE_FLAG = \"_\";\n\nexport const FILE_PATH_SEP = nodepath.sep;\nexport const ROUTE_PATH_SEP = \"/\";\n","import nodepath from \"node:path\";\n\nimport fg, { Pattern } from \"fast-glob\";\nimport type { NonIndexRouteObject } from \"react-router\";\n\nimport {\n  DEFAULT_IGNORE_PATTERN,\n  DYNAMIC_ROUTE_FLAG,\n  ERROR_BOUNDARY_FILE_NAME,\n  HANDLE_FILE_NAME,\n  LAYOUT_FILE_NAME,\n  LOADER_FILE_NAME,\n  NOT_FOUND_FILE_NAME,\n  OPTIONAL_ROUTE_FLAG,\n  PLUGIN_MAIN_PAGE_FILE,\n  ROUTE_PATH_SEP,\n} from \"@/constants\";\n\n/**\n * Collect files from FS by fast-glob.\n */\nexport const collectRoutePages = (\n  pages: Pattern[],\n  ignore: Pattern[] = [],\n): NonIndexRouteObject[] => {\n  const pageModules: string[] = [];\n  let routes: string[] = [];\n\n  for (const pattern of pages) {\n    let files = fg\n      .sync(pattern, {\n        deep: Infinity,\n        ignore: [...DEFAULT_IGNORE_PATTERN, ...ignore],\n      })\n      .map((file) => file.split(ROUTE_PATH_SEP));\n\n    for (const file of files) {\n      // Keep Relative Path For Both Windows, Linux and MacOS\n      pageModules.push(\"/\" + file.join(ROUTE_PATH_SEP));\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    while (true) {\n      const group = files.map((file) => file[0]);\n      if (new Set(group).size > 1) {\n        break;\n      } else {\n        files = files.map((file) => file.slice(1));\n      }\n    }\n\n    routes = [\n      ...routes,\n      ...files.map((file) => file.join(ROUTE_PATH_SEP)).flat(),\n    ];\n  }\n\n  return routes\n    .map((s) => filePathToRoutePath(s))\n    .map((route, index) => {\n      return {\n        path: route,\n        element: pageModules[index],\n      };\n    });\n};\n\nconst validRouteFieldKeyRegexp = (\n  fieldKey: string,\n  filepath: string,\n  options: { allowTs?: boolean } = {},\n) => {\n  if (fieldKey === LOADER_FILE_NAME || fieldKey === HANDLE_FILE_NAME) {\n    options.allowTs = true;\n  }\n\n  return new RegExp(\n    `^([\\\\w\\\\${OPTIONAL_ROUTE_FLAG}\\\\${DYNAMIC_ROUTE_FLAG}]+\\\\.){0,}(${fieldKey})(\\\\.tsx${options.allowTs ? \"?\" : \"\"})$`,\n  ).test(nodepath.basename(filepath));\n};\n\nexport const isFieldKeyRoute = (\n  routeA: NonIndexRouteObject,\n  routeB: NonIndexRouteObject,\n  fieldKey: string,\n) => {\n  if (\n    nodepath.dirname(routeA.element as string) ===\n    nodepath.dirname(routeB.element! as string)\n  ) {\n    const condition = validRouteFieldKeyRegexp(\n      fieldKey,\n      routeB.element! as string,\n    );\n\n    if (routeA.path!.split(ROUTE_PATH_SEP).length === 1 && routeA.path === \"\") {\n      return condition;\n    }\n\n    return (\n      condition &&\n      routeB.path!.split(ROUTE_PATH_SEP).length -\n        routeA.path!.split(ROUTE_PATH_SEP).length ===\n        1\n    );\n  }\n\n  return false;\n};\n\n/**\n * Field keys from *react-router* <Route /> component.\n */\nconst reserved_route_filed_keys = {\n  [LAYOUT_FILE_NAME]: LAYOUT_FILE_NAME,\n  [ERROR_BOUNDARY_FILE_NAME]: ERROR_BOUNDARY_FILE_NAME,\n  [LOADER_FILE_NAME]: LOADER_FILE_NAME,\n  [HANDLE_FILE_NAME]: HANDLE_FILE_NAME,\n};\n\ntype SideEffects = {\n  [Key in keyof typeof reserved_route_filed_keys]?: NonIndexRouteObject;\n} & { routes?: NonIndexRouteObject[] };\n\nexport function collectRouteFieldKeyRoute(routes: NonIndexRouteObject[]) {\n  const testRoutePath = (routePath: string) => {\n    return Object.keys(reserved_route_filed_keys)\n      .map((fieldKey) => {\n        return validRouteFieldKeyRegexp(fieldKey, routePath);\n      })\n      .some((result) => result);\n  };\n\n  return routes.filter((route) =>\n    testRoutePath(nodepath.basename(route.element! as string)),\n  );\n}\n\nconst reserved_root_field_keys = {\n  [NOT_FOUND_FILE_NAME]: NOT_FOUND_FILE_NAME,\n  [LAYOUT_FILE_NAME]: LAYOUT_FILE_NAME,\n  [LOADER_FILE_NAME]: LOADER_FILE_NAME,\n  [HANDLE_FILE_NAME]: HANDLE_FILE_NAME,\n};\n\ntype CollectReturn = {\n  [Key in keyof typeof reserved_root_field_keys]?: NonIndexRouteObject;\n} & { routes?: NonIndexRouteObject[] };\n\nexport function collectRootRouteRelatedRoute(\n  routes: NonIndexRouteObject[],\n): CollectReturn {\n  return Object.assign(\n    Object.keys(reserved_root_field_keys).reduce<CollectReturn>(\n      (object, fieldKey) => ({\n        ...object,\n        [fieldKey]: routes.find((route) => route.path === fieldKey),\n      }),\n      {},\n    ),\n    {\n      routes: routes.filter(\n        (route) => !Object.keys(reserved_root_field_keys).includes(route.path!),\n      ),\n    },\n  );\n}\n\n/**\n * Arrange routes.\n */\nexport const arrangeRoutes = (\n  isolateRoutes: NonIndexRouteObject[],\n  parent: NonIndexRouteObject,\n  subRoutesPathAppendToParent: string[],\n  sideEffectRoutes: NonIndexRouteObject[] = [],\n): NonIndexRouteObject => {\n  const subs = isolateRoutes.filter((route) =>\n    isSubPath(parent.path!, route.path!),\n  );\n\n  const { handle, loader, errorBoundary, layout } = Object.keys(\n    reserved_route_filed_keys,\n  ).reduce<SideEffects>(\n    (object, fieldKey) => ({\n      ...object,\n      [fieldKey]: sideEffectRoutes.find((route) => {\n        return isFieldKeyRoute(parent, route, fieldKey);\n      }),\n    }),\n    {},\n  );\n\n  subRoutesPathAppendToParent.push(\n    ...subs.map((s) => ROUTE_PATH_SEP + s.path!),\n  );\n\n  Object.assign(parent, {\n    path: ROUTE_PATH_SEP + parent.path!,\n    loader: loader?.element,\n    handle: handle?.element,\n    children: subs.map((sub) =>\n      arrangeRoutes(\n        isolateRoutes,\n        sub,\n        subRoutesPathAppendToParent,\n        sideEffectRoutes,\n      ),\n    ),\n    ErrorBoundary: errorBoundary?.element,\n  });\n\n  if (layout) {\n    const parentCopy = deepCopy(parent);\n    delete parent.path;\n    return Object.assign(parent, layout, {\n      path: parentCopy.path,\n      children: [parentCopy],\n      // Don't set error boundary in layout\n      ErrorBoundary: undefined,\n    });\n  }\n\n  return parent;\n};\n\n/**\n * Stringify routes data.\n */\nexport const stringifyRoutes = (routes: NonIndexRouteObject[]): string => {\n  const code = routes\n    .map((route) => {\n      const errorBoundary = route.ErrorBoundary\n        ? [\n            `const { default: ErrorBoundary_ } = await import(\"${route.ErrorBoundary}\")`,\n            `ErrorBoundary = ErrorBoundary_;`,\n          ].join(\"\\n;\")\n        : \"\";\n\n      const handle = route.handle\n        ? [\n            `const { default: handle_ } = await import(\"${route.handle}\");`,\n            `handle = handle_;`,\n          ].join(\"\\n;\")\n        : \"\";\n\n      const loader = route.loader\n        ? [\n            \"async (...args) => {\",\n            `const { default: loader_ } = await import(\"${route.loader}\");`,\n            \"return loader_(...args);\",\n            \"}\",\n          ].join(\"\\n\")\n        : \"undefined\";\n\n      return `{\n        path: \"${route.path}\",\n        loader: ${loader},\n        async lazy(){\n          const { default: Component, initProps ,...rest }  = await import(\"${route.element}\");\n          let ErrorBoundary = undefined;\n          let loader = undefined;\n          let handle = undefined;\n          ${errorBoundary}\n          ${handle}\n          return {\n            ...rest, handle, ErrorBoundary, Component\n          }\n        },\n        children: ${!route.children ? \"[]\" : stringifyRoutes(route.children as NonIndexRouteObject[])}\n      }`;\n    })\n    .join(\",\");\n\n  return `[${code}]`;\n};\n\nexport const deepCopy = <T = unknown>(data: T): T =>\n  JSON.parse(JSON.stringify(data)) as T;\n\n/**\n * Strp slash before and after.\n */\nexport const stripSlash = (filepath: string) => {\n  return filepath.replace(/^\\//, \"\").replace(/\\/$/, \"\");\n};\n\n/**\n * Route path generate by file path.\n */\nexport const filePathToRoutePath = (filepath: string) => {\n  filepath =\n    filepath\n      .replace(nodepath.extname(filepath), \"\")\n      .replaceAll(\".\", ROUTE_PATH_SEP) + nodepath.extname(filepath);\n\n  const path_ = filepath.endsWith(PLUGIN_MAIN_PAGE_FILE)\n    ? stripSlash(filepath.replace(PLUGIN_MAIN_PAGE_FILE, \"\"))\n    : stripSlash(filepath.replace(nodepath.extname(filepath), \"\"));\n\n  return path_\n    .split(ROUTE_PATH_SEP)\n    .map((seg) => {\n      if (seg.startsWith(DYNAMIC_ROUTE_FLAG)) {\n        return seg.replace(DYNAMIC_ROUTE_FLAG, \":\");\n      }\n\n      if (seg.startsWith(OPTIONAL_ROUTE_FLAG)) {\n        const [, p] =\n          new RegExp(`^\\\\${OPTIONAL_ROUTE_FLAG}(.+)`).exec(seg) ?? [];\n        return p ? `:${p}?` : seg;\n      }\n\n      return seg;\n    })\n    .join(ROUTE_PATH_SEP);\n};\n\n/**\n * Sub-path evaluation.\n */\nexport const isSubPath = (parentPath: string, subPath: string) => {\n  if (\n    parentPath !== \"\" &&\n    subPath.startsWith(parentPath) &&\n    subPath.split(ROUTE_PATH_SEP).length -\n      parentPath.split(ROUTE_PATH_SEP).length ===\n      1\n  ) {\n    return true;\n  }\n\n  return false;\n};\n","import * as logger from \"@moccona/logger\";\nimport { createFilter } from \"@rollup/pluginutils\";\nimport { type Pattern } from \"fast-glob\";\nimport type { NonIndexRouteObject } from \"react-router\";\nimport { loadEnv, type Plugin, type ViteDevServer } from \"vite\";\n\nimport { PLUGIN_NAME, PLUGIN_VIRTUAL_MODULE_NAME } from \"@/constants\";\nimport {\n  arrangeRoutes,\n  collectRootRouteRelatedRoute,\n  collectRouteFieldKeyRoute,\n  collectRoutePages,\n  stringifyRoutes,\n} from \"@/utils\";\n\ntype ConventionalRouterProps = {\n  include: Pattern | Pattern[];\n  exclude: Pattern | Pattern[];\n};\n\nconst { createScopedLogger } = logger;\n\nexport const log = createScopedLogger(PLUGIN_NAME);\n\nexport default function ConventionalRouter(\n  options?: Partial<ConventionalRouterProps>,\n): Plugin {\n  options = { include: [], exclude: [], ...(options ?? {}) };\n\n  let { include } = options;\n  let { exclude } = options;\n\n  // Filtering the real page files.\n  const filter = createFilter(include, exclude);\n\n  // Constrcut filter patterns\n  include = (Array.isArray(include) ? include : [include]) as string[];\n  exclude = (Array.isArray(exclude) ? exclude : [exclude]) as string[];\n\n  let devServer: ViteDevServer;\n\n  return {\n    name: PLUGIN_NAME,\n    config(config, env) {\n      const envs = loadEnv(env.mode, config.envDir ?? \".\", \"\");\n      const { BASE_NAME } = envs;\n      config.base = BASE_NAME || \"\";\n      return config;\n    },\n    configureServer(server) {\n      devServer = server;\n    },\n    resolveId(source) {\n      if (source === PLUGIN_VIRTUAL_MODULE_NAME) {\n        log.info(\"Read virtual routes\");\n        return source;\n      }\n\n      return undefined;\n    },\n    load(id) {\n      if (id === PLUGIN_VIRTUAL_MODULE_NAME) {\n        const allRoutes = collectRoutePages(include, exclude);\n        const subRoutesPathAppendToParent: string[] = [];\n\n        /**\n         * Only need one not found fallback\n         */\n        const {\n          routes = [],\n          \"404\": notFoundRoute,\n          layout: rootLayoutRoute,\n        } = collectRootRouteRelatedRoute(allRoutes);\n\n        const sideEffectRoutes = collectRouteFieldKeyRoute(routes);\n\n        // 404 Page For Route.\n        if (notFoundRoute) {\n          subRoutesPathAppendToParent.push(`/${notFoundRoute.path!}`);\n        }\n\n        const isolateRoutes = routes.filter(\n          (r) =>\n            !new Set(sideEffectRoutes.map((route) => route.element)).has(\n              r.element,\n            ),\n        );\n\n        const mapCallback = (r: NonIndexRouteObject) => {\n          if (r.path!.startsWith(\"/\")) {\n            return r;\n          } else {\n            return {\n              ...r,\n              path: `/${r.path}`,\n            };\n          }\n        };\n\n        isolateRoutes\n          // First filer\n          .filter((r) => r.path!.split(\"/\").length === 1)\n          // Start arrange\n          .forEach((route) =>\n            arrangeRoutes(\n              isolateRoutes,\n              route,\n              subRoutesPathAppendToParent,\n              sideEffectRoutes,\n            ),\n          );\n\n        // Remove all sub routes.\n        const intermediaRoutes = isolateRoutes.filter(\n          (r) => !subRoutesPathAppendToParent.includes(r.path!),\n        );\n\n        subRoutesPathAppendToParent.length = 0;\n\n        // 2.\n        intermediaRoutes\n          // Second filter\n          .filter((r) => r.path!.split(\"/\").length > 2)\n          // Start arrange\n          .forEach((route) =>\n            arrangeRoutes(\n              intermediaRoutes,\n              route,\n              subRoutesPathAppendToParent,\n              sideEffectRoutes,\n            ),\n          );\n\n        let finalRoutes = intermediaRoutes\n          .filter((r) => !subRoutesPathAppendToParent.includes(r.path!))\n          .map(mapCallback);\n\n        if (rootLayoutRoute) {\n          finalRoutes = [\n            {\n              ...rootLayoutRoute,\n              path: \"/\",\n              children: finalRoutes,\n            },\n          ];\n        }\n\n        if (notFoundRoute) {\n          finalRoutes.push({ ...notFoundRoute, path: \"*\" });\n        }\n\n        return {\n          code: `\n          const routes = ${stringifyRoutes(finalRoutes)};\n          if(import.meta.env.DEV) {\n            console.log(routes);\n          }\n          export default routes;\n          `,\n        };\n      }\n\n      return undefined;\n    },\n    watchChange(id, change) {\n      if (\n        filter(id) &&\n        (change.event === \"create\" || change.event === \"delete\")\n      ) {\n        this.info(`Prepare restart because ${id} change`);\n        devServer.restart().catch((error: unknown) => {\n          this.warn(`Restart failed: ${(error as Error).message}`);\n        });\n      }\n    },\n  };\n}\n"]}
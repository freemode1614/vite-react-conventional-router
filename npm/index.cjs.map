{"version":3,"sources":["../src/index.ts"],"names":["nodepath","fg"],"mappings":"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","file":"index.cjs","sourcesContent":["import nodepath from \"node:path\";\n\nimport fg, { Pattern } from \"fast-glob\";\nimport type { NonIndexRouteObject } from \"react-router\";\nimport { type Plugin } from \"vite\";\n\nconst PLUGIN_NAME = \"vite-plugin-conventional-router\";\nconst PLUGIN_VIRTUAL_MODULE_NAME = \"virtual:routes\";\nconst PLUGIN_MAIN_PAGE_FILE = \"index.tsx\";\n\nconst LAYOUT_FILE_NAME = \"layout\",\n  NOT_FOUND_FILE_NAME = \"404\",\n  ERROR_BOUNDARY_FILE_NAME = \"errorBoundary\";\n\nconst OPTIONAL_ROUTE_FLAG = \"$\",\n  DYNAMIC_ROUTE_FLAG = \"@\";\n\ntype ConventionalRouterProps = {\n  pages: Pattern | Pattern[];\n};\n\nexport const deepCopy = <T = unknown>(data: T): T => JSON.parse(JSON.stringify(data));\n\n/**\n * Strp slash before and after.\n */\nexport const stripSlash = (filepath: string) => {\n  return filepath.replace(/^\\//, \"\").replace(/\\/$/, \"\");\n};\n\n/**\n * Route path generate by file path.\n */\nexport const filePathToRoutePath = (filepath: string) => {\n  filepath = filepath.replace(nodepath.extname(filepath), \"\").replaceAll(\".\", \"/\") + nodepath.extname(filepath);\n\n  const path_ = filepath.endsWith(PLUGIN_MAIN_PAGE_FILE)\n    ? stripSlash(filepath.replace(PLUGIN_MAIN_PAGE_FILE, \"\"))\n    : stripSlash(filepath.replace(nodepath.extname(filepath), \"\"));\n\n  return path_\n    .split(\"/\")\n    .map((seg) => {\n      if (seg.startsWith(DYNAMIC_ROUTE_FLAG)) {\n        return seg.replace(DYNAMIC_ROUTE_FLAG, \":\");\n      }\n\n      if (seg.startsWith(OPTIONAL_ROUTE_FLAG)) {\n        const [, p] = new RegExp(`^\\\\${OPTIONAL_ROUTE_FLAG}(.+)`).exec(seg) ?? [];\n        return p ? `:${p}?` : seg;\n      }\n\n      return seg;\n    })\n    .join(\"/\");\n};\n\n/**\n * Collect files from FS by fast-glob.\n */\nexport const collectRoutePages = (pages: Pattern[]): NonIndexRouteObject[] => {\n  const pageModules: string[] = [];\n  let routes: string[] = [];\n\n  for (const pattern of pages) {\n    let files = fg.sync(pattern, { deep: Infinity }).map((file) => file.split(\"/\"));\n\n    for (const file of files) {\n      pageModules.push(nodepath.resolve(file.join(\"/\")));\n    }\n\n    while (true) {\n      const group = files.map((file) => file[0]);\n      if (new Set(group).size > 1) {\n        break;\n      } else {\n        files = files.map((file) => file.slice(1));\n      }\n    }\n\n    routes = [...routes, ...files.map((file) => file.join(\"/\")).flat()];\n  }\n\n  return routes\n    .map((s) => filePathToRoutePath(s))\n    .map((route, index) => {\n      return {\n        path: route,\n        element: pageModules[index],\n      };\n    });\n};\n\n/**\n * Sub-path evaluation.\n */\nexport const isSubPath = (parentPath: string, subPath: string) => {\n  if (\n    parentPath !== \"\" &&\n    subPath.startsWith(parentPath) &&\n    subPath.split(\"/\").length - parentPath.split(\"/\").length === 1\n  ) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const isLayoutFilePath = (filepath: string) => {\n  return new RegExp(\n    `^([\\\\w\\\\${OPTIONAL_ROUTE_FLAG}\\\\${DYNAMIC_ROUTE_FLAG}]+\\\\.){0,}(${LAYOUT_FILE_NAME})(\\\\.tsx)$`,\n  ).test(nodepath.basename(filepath));\n};\n\n/**\n *\n * Two possible scenario\n * 1.\n * xx/xx/index.tsx\n * xx/xx/layout.tsx\n *\n * 2.\n * xx/xx.tsx\n * xx/xx.layout.tsx\n */\nexport const isLayoutRoute = (route: NonIndexRouteObject, layoutRoute: NonIndexRouteObject) => {\n  if (nodepath.dirname(route.element! as string) === nodepath.dirname(layoutRoute.element! as string)) {\n    const condition1 = isLayoutFilePath(nodepath.basename(layoutRoute.element! as string));\n    return condition1 && layoutRoute.path!.split(\"/\").length - route.path!.split(\"/\").length === 1;\n  }\n\n  return false;\n};\n\nexport const isErrorBoundaryFilePath = (filepath: string) => {\n  return new RegExp(\n    `^([\\\\w\\\\${OPTIONAL_ROUTE_FLAG}\\\\${DYNAMIC_ROUTE_FLAG}]+\\\\.){0,}(${ERROR_BOUNDARY_FILE_NAME})(\\\\.tsx)$`,\n  ).test(nodepath.basename(filepath));\n};\n\n/**\n *\n * Two possible scenario\n * 1.\n * xx/xx/index.tsx\n * xx/xx/errorBoundary.tsx\n *\n * 2.\n * xx/xx.tsx\n * xx/xx.errorBoundary.tsx\n *\n */\nexport const isErrorBoundaryRoute = (route: NonIndexRouteObject, errorBoundaryRoute: NonIndexRouteObject) => {\n  if (nodepath.dirname(route.element! as string) === nodepath.dirname(errorBoundaryRoute.element! as string)) {\n    const condition1 = isErrorBoundaryFilePath(nodepath.basename(errorBoundaryRoute.element! as string));\n    if (route.path!.split(\"/\").length === 1) {\n      return condition1;\n    }\n    return condition1 && errorBoundaryRoute.path!.split(\"/\").length - route.path!.split(\"/\").length === 1;\n  }\n\n  return false;\n};\n\n/**\n * Arrange routes.\n */\nexport const arrangeRoutes = (\n  routes: NonIndexRouteObject[],\n  parent: NonIndexRouteObject,\n  subRoutesPathAppendToParent: string[],\n  layoutAndErrorBoundaries: NonIndexRouteObject[] = [],\n): NonIndexRouteObject => {\n  const subs = routes.filter((route) => isSubPath(parent.path!, route.path!));\n  const layout = layoutAndErrorBoundaries.find((route) => isLayoutRoute(parent, route));\n  const errorBoundary = layoutAndErrorBoundaries.find((route) => isErrorBoundaryRoute(parent, route));\n\n  subRoutesPathAppendToParent.push(...subs.map((s) => \"/\" + s.path!));\n\n  Object.assign(parent, {\n    path: \"/\" + parent.path!,\n    children: subs.map((sub) => arrangeRoutes(routes, sub, subRoutesPathAppendToParent, layoutAndErrorBoundaries)),\n    ErrorBoundary: errorBoundary ? errorBoundary.element! : undefined,\n  });\n\n  if (layout) {\n    const parentCopy = deepCopy(parent);\n    return Object.assign(parent, layout, {\n      path: parentCopy.path,\n      children: [parentCopy],\n      // Don't set error boundary in layout\n      ErrorBoundary: undefined,\n    });\n  }\n\n  return parent;\n};\n\n/**\n * Stringify routes data.\n */\nexport const stringifyRoutes = (routes: NonIndexRouteObject[]): string => {\n  const code = routes\n    .map(\n      (route) => `{\n        async lazy(){\n          const { default: Component, ...rest }  = await import(\"${route.element}\");\n          let ErrorBoundary = undefined;\n          ${route.ErrorBoundary\n          ? `const { default: ErrorBoundary_ } = await import(\"${route.ErrorBoundary}\");\n            ErrorBoundary = ErrorBoundary_;\n          `\n          : \"\"\n        }\n          return {\n            ...rest, ErrorBoundary, Component,\n          }\n        },\n        path: \"${route.path}\",\n        children: ${!route.children ? \"[]\" : stringifyRoutes(route.children as NonIndexRouteObject[])}\n      }`,\n    )\n    .join(\",\");\n\n  return `[${code}]`;\n};\n\nexport default function ConventionalRouter(options?: Partial<ConventionalRouterProps>): Plugin {\n  if (!options) {\n    options = { pages: [] };\n  }\n\n  let { pages = [] } = options;\n\n  if (!Array.isArray(pages)) {\n    pages = [pages];\n  }\n\n  return {\n    name: PLUGIN_NAME,\n    resolveId(source) {\n      if (source === PLUGIN_VIRTUAL_MODULE_NAME) {\n        return source;\n      }\n\n      return null;\n    },\n    async load(id) {\n      if (id === PLUGIN_VIRTUAL_MODULE_NAME) {\n        const routes = collectRoutePages(pages);\n        const subRoutesPathAppendToParent: string[] = [];\n\n        /**\n         * Only need one not found fallback\n         */\n        const notFoundRoute = routes.find((route) => route.path === NOT_FOUND_FILE_NAME);\n        const rootLayoutRoute = routes.find((route) => route.path === LAYOUT_FILE_NAME);\n\n        const layoutsAndErrorBoundaries = routes.filter((route) => {\n          return (\n            (isLayoutFilePath(nodepath.basename(route.element! as string)) ||\n              isErrorBoundaryFilePath(nodepath.basename(route.element! as string))) &&\n            route.path !== rootLayoutRoute?.path\n          );\n        });\n\n        if (notFoundRoute) {\n          subRoutesPathAppendToParent.push(`/${notFoundRoute.path!}`);\n        }\n\n        const layoutsAndErrorBoundariesElements = new Set(layoutsAndErrorBoundaries.map((route) => route.element));\n\n        const routesReadyToArrange = routes.filter(\n          (r) =>\n            !layoutsAndErrorBoundariesElements.has(r.element!) &&\n            r.element !== notFoundRoute?.element &&\n            r.element !== rootLayoutRoute?.element,\n        );\n\n        const mapCallback = (r: NonIndexRouteObject) => {\n          if (r.path!.startsWith(\"/\")) {\n            return r;\n          } else {\n            return {\n              ...r,\n              path: `/${r.path}`,\n            };\n          }\n        };\n\n        routesReadyToArrange\n          // First filer\n          .filter((r) => r.path!.split(\"/\").length === 1)\n          // Start arrange\n          .forEach((route) =>\n            arrangeRoutes(routesReadyToArrange, route, subRoutesPathAppendToParent, layoutsAndErrorBoundaries),\n          );\n\n        // Remove all sub routes.\n        const intermediaRoutes = routesReadyToArrange.filter((r) => !subRoutesPathAppendToParent.includes(r.path!));\n\n        subRoutesPathAppendToParent.length = 0;\n\n        intermediaRoutes\n          // Second filter\n          .filter((r) => r.path!.split(\"/\").length > 2)\n          // Start arrange\n          .forEach((route) =>\n            arrangeRoutes(intermediaRoutes, route, subRoutesPathAppendToParent, layoutsAndErrorBoundaries),\n          );\n\n        let finalRoutes = intermediaRoutes\n          .filter((r) => !subRoutesPathAppendToParent.includes(r.path!))\n          .map(mapCallback);\n\n        if (rootLayoutRoute) {\n          finalRoutes = [\n            {\n              ...rootLayoutRoute,\n              path: \"/\",\n              children: finalRoutes,\n            },\n          ];\n        }\n\n        if (notFoundRoute) {\n          finalRoutes.push({ ...notFoundRoute, path: \"*\" });\n        }\n\n        return {\n          code: `\n          const routes = ${stringifyRoutes(finalRoutes)};\n          console.log(routes);\n          export default routes;\n`,\n        };\n      }\n\n      return null;\n    },\n  };\n}\n"]}